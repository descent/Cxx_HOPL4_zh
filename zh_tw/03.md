# 3. C++ 標準委員會

國際 C++ 標準委員會正式名稱為 **ISO/IEC JTC1/SC2/WG21**, 它是 C++ 發展的核心。自 1991 年成立以來, 就一直如此。而從 1989 年開始到它成立之前, C++ 開發的中心則是美國國家標準學會 (ANSI) 的 C++ 標準委員會 [Stroustrup 1993]。C++ 沒有腰纏萬貫的所有者, 也沒有其他重要的資金提供來源, 因此社區依賴于企業開發和開源項目。對於很多處于相互競爭的組織中的人來說, WG21 和各個國家的標準委員會是他們能夠會面並聯合解決問題的唯一場合。

委員會成員都是志願者, 也沒有帶薪的秘書處, 雖然許多委員確實以其工作組織的代表身份出現。在每次會議上, 都會有人自豪地聲稱就代表“自己”。也就是說, 他們沒有得到贊助, 只代表自己。有些人換工作後, 就會代表新組織, 這種情況並不少見。許多人以“參加 C++ 標準委員會”作為接受新工作的條件。有人加入了委員會來學習 C++, 有人則把“C++ 委員會成員”當作資格來引用 (並非一定是真的) 。

有些人僅參加過幾次會議, 不那麼經常。另一方面, 也有人一直參加了大多數會議, 數十年沒有間斷。一開始時, 還有現在, 我們一年開三次會。在 1998 年標準之後的幾年裡, 我們一年只開兩次會。目前, 除了面對面的會議, 還有很多的電話會議進行補充, 以及天天都有的大量電子郵件。

在這裡, 我會描述

- 標準的作用 ([§3.1](#31-標準)) 
- 委員會的組織 ([§3.2](#32-組織)) 
- 委員會的結構對 C++ 設計的影響 ([§3.3](#33-對設計的影響)) 

## 3.1 標準

標準委員會的目的是編寫標準。制定標準的一個官方理由是“**促進貿易, 特別是減少國際貿易的技術壁壘和人為障礙**”, 及“**提供實現經濟、效率和互操作性的框架**”。標準是規範, 不是實現。它的目的是保持多個實現一致, 並確定“一致性”在一個必須能夠有效利用各種不同底層硬體的世界裡到底意味着什麼。許多程式員在理解這一點上存在問題。他們要麼認為當前的編譯器就是語言的定義, 要麼難以理解為什麼很難在許多不同的、通常是競爭性的組織之間達成 100％ 的協議。在 1990 年代, 委員會考慮過制定形式規約 (formal specification) , 但諮詢過世界一流的專家後得出結論, 規約技術的進展和成員的水平都還達不到制定 C++ 形式規約的程度。當然, 也考慮過參考實現, 但語言的複雜度, 特別是與硬體使用和優化相關的問題, 已經挫敗了這種想法。如果有參考實現, 它會太複雜, 也會代價過大。要麼就得把它簡化到一種對最困難的問題沒有幫助的程度, 但這樣的困難問題正是最需要參考實現的場合。再有, 當 N 個彼此競爭的實現團隊記錄他們的決策、運行廣泛的合規性測試並討論它們的不同之處時, 會有些意外收穫; 如果已經有了個複雜的參考實現, 就可能掩蓋掉這樣的意外收穫。對於 C++, 從前端實現來說 (Clang、EDG、GCC 和微軟) N 至少為 4, 至于後端, N 少說有十幾個。

因此, 標準委員會正在努力解決擁有多種實現帶來的問題。另一條路是冒險搞單一文化。如果 C++ 技術只來源於一個組織, 那麼無論好壞, 每個人都會得到相同的東西。一個控制“唯一真正實現”的組織將在社區中擁有主導話語權, 他們出現的問題, 就會影響到所有人。特別是, 一旦有資金問題、商業顧慮、政治見解或者技術上的一意孤行, 就會嚴重破壞語言及其使用者群體。

無論好壞, C++ 社區選擇了“半組織”的混亂, 裡面有一個很大的委員會加上多個編譯器、工具及庫的供應者。我們沒有用統一所有權或獨裁者模式。

## 3.2 組織

對於 C++17 和 C++ 20 的工作, 每次面對面的 WG21 會議有多達 250 人出席, 而總成員人數約為出席人數的兩倍。此外, 加拿大、芬蘭、法國、德國、俄羅斯、西班牙、英國、美國等十幾個國家都有國家標準委員會以及 C++ 標準技術聯盟的付費支援成員。成員代表了一百多個組織。為了讓大家有所瞭解, 在此列舉部分成員所屬組織: 蘋果、Bloomberg、歐洲核子研究中心、Codeplay、EDG (Edison Design Group) 、Facebook、谷歌、IBM、英特爾、微軟、摩根士丹利、英偉達、Qt、高通、紅帽、Ripple、美國 Sandia 國家實驗室、拉珀斯維爾應用科技大學 (HSR) 和馬德里卡洛斯三世大學。編譯器供應者、硬體供應者、金融、遊戲、庫供應者、平台供應者、國家實驗室 (物理) 等都有堅實的代表。早期 C++ 中突出的電信業者的身影已經減少, 而過去極少的大學的身影似乎在增加。

顯然, 如此龐大的組織和個人組成的群體代表着千差萬別的興趣和技術背景, 需要一個組織結構來運作。會議是圍繞工作組 (WG) 和研究組 (SG) 進行組織的。2019 年的夏天, 我們已經有了這樣一些分組: 

- **核心工作組** (Core WG 或 CWG) ——編寫語言的最終標準文本——主席 Michael Miller (EDG) 。
- **庫工作組** (Library WG 或 LWG) ——為標準庫編寫最終標準文本——主席 Marshall Clow (C++ 聯盟, 之前代表高通) 。
- **演化工作組** (Evolution WG 或 EWG) ——處理語言建議——主席 Ville Voutilainen (Qt, 之前代表 Symbio) 。
- **庫演化工作組** (Library Evolution WG 或 LEWG) ——處理標準庫提案——主席 Titus Winters (谷歌) 。

研究組探索新領域並設計可能的標準化: 

- **SG1 並發**——並發和並行性主題——主席 Olivier Giroux (英偉達) 。
- **SG5 事務性存儲**——探索事務性存儲的構造——主席 Michael Wong (Codeplay, 之前代表 IBM) 。
- **SG6 數值**——包括但不限于定點數、浮點數和分數——主席 Lawrence Crowl (“自己”, 之前代表谷歌和 Sun) 。
- **SG7 編譯期編程**——最初專注于編譯期反射, 然後擴展到一般的編譯期編程——主席 Chandler Carruth (谷歌) 。
- **SG12 未定義的行為和漏洞**——系統地審查漏洞和未定義/未指定的行為——主席 Gabriel Dos Reis (微軟, 之前代表得州農工大學) 。
- **SG13 人機界面和 I/O**——精選的底層輸出 (例如圖形、音頻) 和輸入 (例如鍵盤、指點設備) 的 I/O 原語——主席 Roger Orr (英國標準 (BSI) ) 。
- **SG14 遊戲開發和低延遲**——遊戲開發者和其他有低延遲要求的人感興趣的主題——主席 Michael Wong (Codeplay, 之前代表 IBM) 。
- **SG15 工具**——與針對標準 C++ 的開發者工具創建有關的主題, 其中包括但不僅限于模組和包管理——主席 Titus Winters (谷歌) 。
- **SG16 Unicode**——與 C++ 中的 Unicode 文本處理相關的主題——主席 Tom Honermann (Synopsys) 。
- **SG19 機器學習**——主席 Michael Wong (CodePlay, 之前代表 IBM) 
- **SG20 教育**——探索可以支援學習者和教師掌握今天的 C++ 的方法——主席 Jan Christiaan van Winkel (谷歌) 
- **SG21 契約**——在 C++20 失敗後嘗試設計出契約系統 ([§9.6.1](09.md#961-契約)) ——主席 John Spicer (EDG) 

2017 年成立了一個小組來解決與語言和標準庫設計缺乏方向有關的問題 [Dawes et al. 2018]。該**方向組** (DG) 的成員由召集人與工作組主席協商後任命, 其成員是委員會、語言和標準庫的長期貢獻者。最初的成員是 Beman Dawes、Howard Hinnant、Bjarne Stroustrup、David Vandevoorde 和 Michael Wong。之後, Beman 退休, Roger Orr 加入。DG 的主席是輪流擔任的, 從我開始。DG 是諮詢機構, 其政策是只有在其成員一致同意的情況下才能提出意見。它維護有一份描述其建議的文件 [Dawes et al. 2018; Hinnant et al. 2019]。

工作組可持續十年以上, 成員變化也很少。研究組則聚散自由, 可能因興趣使然, 或者因為工作已經完成並提交給工作組進行最後的處理。例如, 四個最重要的研究組已宣告勝利完成並解散: 

- **SG2 模組**——主席 Gabriel Dos Reis (微軟, 之前代表得州農工大學) 。
- **SG3 檔案系統**——主席 Beman Dawes (“自己”) 。
- **SG8 概念**——主席 Andrew Sutton (俄亥俄州阿克倫大學, 之前代表得州農工大學) 。
- **SG9 範圍**——更新 STL, 以使用概念, 簡化表示法, 及提供無限序列和管道——主席, Eric Niebler (Facebook) 。

**SG4 網路**, 目前處于休眠狀態, 因為其結果正在等待被合併到標準 ([§8.8.1](08.md#881-網路庫)) 中。另一個研究組 **SG11 資料庫**, 因缺乏共識和缺乏足夠數量的志願者完成工作而解散。

某些研究組會產出技術規範 (TS) , 這些技術規範可能是具有重要意義的檔案, 也以標準本身的風格寫就。它們具有一定的官方 (ISO) 地位, 但不能提供國際標準 (IS) 所具有的長期穩定性。並發研究組 (SG1) 自 2006 年以來一直活躍, 大部分時間由 Hans-J. Boehm (谷歌, 之前代表過惠普實驗室和 SGI) 領導, 它的地位已經接近 WG 了。

除了這些分組外, 還有一個半官方的 C/C++ 聯絡組, 由同時加入 C++ 委員會和 C 委員會 (ISO/SC22/WG14) 的成員組成。這個小組力圖減少 C 和 C++ 之間的不兼容性, 而 C++ 標準也會把每種不兼容之處記錄下來。如果沒有聯絡小組的不斷努力, C 和 C++ 的兼容性遠沒有現在好。不過, 即便如此, 大多數從 C++ 導入 C 的特性都被修改過, 而這就引入了一些不兼容性。

ISO 只需要也只認可三名正式官員: 

- **召集人**——擔任工作組主席, 制定工作組會議時間表 (召開會議) , 任命研究組, 並向更高級別的 ISO (SC22、JTC1 和 ITTF) 負責——Herb Sutter (微軟) , 自 2002 年以來一直擔任該職位的工作, 除 2008–2009 年期間是由 P.J. Plauger (Dinkumware) 擔任。
- **項目編輯**——最終負責將委員會批准的更改應用於標準的工作草案——Richard Smith (谷歌) ; Pete Becker (Dinkumware) 負責 C++11; Stefanus Du Toit (Intel) 負責 C++14。
- **書記**——負責記錄和分發 WG21 會議的會議紀要——Nina Ranns (Edison Design Group, 之前代表 Symantec) 。

各個國家的標準委員會有各自自己的官員和章程。

顯然, 這些年來這些職位由不同的人擔任過, 但儘管工作量通常很大, 很少有人在職少於 5 年。我曾擔任 EWG 的主席 24 年, 到 2014 年才把這一職位移交給 Ville Voutilainen。

通常, 較小的提案直接提交給 EWG 和/或 LEWG, 較大的提案則從研究組開始。提案需要以書面形式提出, 並有人進行演示。一般來說, 處理一項重要的提案需要數次會議 (通常為數年) , 並且需要數篇論文、修訂論文和反覆演示。最後, 已經獲得大力支援的提案將提交給整個委員會進行最終表決。召集人查看表決結果並裁定是否達成共識。共識不只是要多數。委員會更傾向于能在經過工作組處理和投票後獲得一致同意, 如果達不到, 通常至少也需要 9 比 1 或 8 比 2 的優勢。召集人很可能會認為 8 比 2 的多數票“未達成共識”。如果國家標準機構的負責人或幾個主要委員表示強烈反對, 就會發生這種情況。這樣議題就會處于懸而未決的狀態或者導致提案只被部分採納。

標準會議令人筋疲力盡。通常, 委員從早餐到午夜一直在討論工作問題。大多數時候, 正式會議在 8:30–12:30 和 14:00–17:30 舉行, 加上大多數時候都會進行的晚間會議 (19:00–22:00) 。正在準備提案的委員的工作時間比這些還要長。WG 和 SG 主席一般在大多數用餐時間都在開會。周一至周五是全天, 而如果沒有任何意外發生, 大多數委員會成員到了星期六的 15:00 左右會收工。不過, 當會議在諸如夏威夷科納 (Kona) 之類的好地方舉行時, 委員會以外的人似乎都不願意相信開會並不是什麼度假。

在 WG 和 SG 裡, 每個出席者都可以投一票。委員會全體會議的正式投票則是每個到會的組織一票 (這樣, 大型組織就不會有多票) , 再加上國家標準機構的票數。“技術性投票”和國家機構投票必須一致才算達成共識。

委員會 2006 年以前的歷史記錄在 [Stroustrup 1993, 1994, 2007] 中。C++ 基金會 ([§10.2](10.md#102-c-社區)) 在其網站 ([isocpp.org/std](https://isocpp.org/std)) 上維護了一份會及時更新的描述, 涵蓋組織、關鍵人物和委員會流程。

從 1989 年起, 委員會的所有論文几乎都可以從一份文集中獲取到 [WG21 1989–2020]。目前, 該文集每年增加 500 多篇論文。另外, 很多委員會的討論是在已歸檔的郵件列表中進行的。每天可能有超過一百條郵件消息。要跟上委員會中發生的所有事情非常難, 特別是由於很多事情需要專門的技術知識才能跟進。我將自己的 WG21 論文集保存在主頁 [Stroustrup 1990–2020] 上。

傳統上, ISO 標準每十年左右修訂一次。例如, 我們有 C89、C99 和 C11。如此長的修訂周期是有問題的, 如果新特性錯過了特性凍結, 我們就會要再等上 12 年左右才能將它加入標準。人們自然就會主張將即將通過的標準拖延一兩年: “這個特性太重要了, 不能等, 因此得延遲一下標準的發佈! ”這就是為什麼原本的 C++0x 結果成了 C++11, 在 C++98 後過了 13 年。

在 C++11 之後, 一些委員會成員希望縮短周期, 召集人 Herb Sutter 建議我們採用列車模型。也就是說, 列車在預定時間出發, 任何沒上車的人將不得不等待下一班。大家喜歡這個建議, 也花了挺長時間討論標準修訂之間的合適間隔。我主張短點, 3 年, 因為再長 (例如 5 年) 就容易被“這個特性非常重要, 等不了”這樣的說法拖累, 導致發佈延遲。我們商定了三年的發佈周期, Herb Sutter 補充建議採用交替發行大版本和小版本的英特爾“滴答”模型。這也得到了同意, 因此在 C++11 ([§4](04.md#4-c11感覺像是門新語言)) 三年後, 我們發佈了 C++14 ([§5](05.md#5-c14完成-c11)) , 它納入了之前被延遲的特性並糾正了早期使用中發現的小問題。C++17 也按時交付, 但可惜並不是一次大升級 ([§8](08.md#8-c17大海迷航)) 。C++20 在 2019 年 2 月通過投票, 確定了完整的發佈特性。最終技術性投票于 2020 年 2 月在布拉格完成。

## 3.3 對設計的影響

這樣的工作組織方式、複雜的決策流程以及大量的參與者會如何影響 C++ 的發展? 看看委員會的規模、組成及其流程, 我認為, 任何建設性成果居然能從中產生, 都足以令人驚喜。這已經不只是“委員會的設計”了, 而是“多委員會的聯合設計”。

此外, 委員會的管理結構非常薄弱, 甚至缺乏最基本的管理工具: 

- 成員資格、發言或投票沒有任何資質要求 (例如, 學歷或實際經驗) 。支付 ISO 會員費 (2018 年美國會員為 1280 美元) 並參加兩次會議, 就能擁有正式投票權。在研究組和工作組中, 任何人都可以發言與投票, 即使這是他們的第一次參加會議。
- 除了讓提案得到採納, 以及看到改進後的標準而感到滿足, 並沒有任何其他回報。不過, 滿足感確實是一個主要動力。
- 沒有真正的辦法來阻止破壞性行為。非官方委員會管理人員所能做的只是有禮貌地提醒人們不要做別人認為具有破壞性的事情。然而委員們對於什麼是有破壞性的, 意見也不一致。

當考慮在一個大型委員會裡演化一門語言的各種問題之前, 請記住委員會裡大部分時間和工作都是為瞭解決“小問題”; 就是那些不會上升到語言設計哲學、學術出版物、或會議演示層面的問題。它們對於防止語言及其標準庫被分割成方言, 並保證在編譯器和平台之間的可移植性至關重要。這些問題包括: 命名、名稱查找、重載決策、語法細節、構造的確切含義、臨時變數的生存周期、連結, 還有其他很多很多。許多問題需要技巧才能得以解決, 而拙劣的解決方案可能帶來讓人吃驚而具有破壞性的後果。解決方案往往經過精心設計, 以最大程度減少對現有程式碼的破壞。委員會每年解決數百個問題。我估計委員至少要為此花費他們時間和精力的三分之一, 乃至于三分之二。這項工作往往被忽視和低估。如果你用過計算機或計算機化的設備 (例如電話或汽車) , 你得感謝 CWG 和 LWG 的工作。

當關注由一個龐大的委員會引起的問題時, 也請記住, 這些問題本質是一種有錢人的煩惱: C++ 的標準化流程由數百位各種不同背景的熱心人士所驅動, 他們的經驗各不相同, 但都滿懷理想主義。

委員會應起到過濾作用, 也就是說, 把壞提案擋在標準之外, 同時, 還要提升最後通過的提案的品質。委員會的存在, 是要鼓勵大家提出建議, 並主動提供幫助。然而, 並沒有正式的提案徵求流程。

不存在全職的 C++ 設計者, 儘管有許多全職人員從事 C++ 編譯器、庫和工具方面的工作。直到最近, 委員會中還很少有人從事應用程式開發, 這是一個問題, 因為它使委員會偏向于語言“律師”、高階特性和實現問題, 而不是直接解決大量 C++ 開發者的需求——很多成員只是間接地瞭解這些需求。最近新成員急劇增加, 也許會部分緩解這個問題。

委員會中的教育工作者相對較少。這可能是個問題, 因為委員會 (理所當然地) 高度重視“易於學習”, 但是委員們對其含義有着非常不同的理念 (經常會意見強烈) 。這往往使關於“簡單性”和“易用性”的討論變得混亂。

當思考組織問題對 C++ 發展的影響時, 請記住, ISO 流程本不是為 200 人的會議而設計的——典型的 ISO 編程語言委員會只有一二十人。平均而言, 我們在某種程度上是通過識別和解決問題來進行管理。考慮下面這些觀察到的問題: 

- **延遲**: 多階段的流程為延遲、阻止提案和提案變化提供了很多機會。常常出現幾十名委員堅持要滿足他們的要求的情況, 往往是通過闡釋、擴展和尋找特例的方式。一個人眼中的過度延遲在另一個人看來卻是盡職儘力。

    例如: 概念 (當前方案為 6 年 ([§6](06.md#6-概念)) ) 、契約 (從開始到失敗花了 6 年 ([§9.6.1](09.md#961-契約)) ) 、網路 (15 年, 仍在進行中 ([§8.8.1](08.md#881-網路庫)) ) 和 constexpr (5 年 ([§4.2.7](04.md#427-constexpr-函數)) ) 。甚至 `nullptr` 被接受也花費了三年時間 ([§4.2.6](04.md#426-nullptr)) 。

- **孤立特性**: 大多數委員會成員喜歡特性的添加。另一方面, 他們 (非常合理地) 深刻地擔心破壞現有程式碼的可能性。這給了**孤立特性**系統性的優勢, 孤立特性是不影響語言和標準庫其餘部分的小提案。這樣的小提案很少會對語言的使用產生重大影響, 但卻會增加學習和實現的複雜性。而且, 到頭來, 它們往往還是會和其他特性發生令人驚訝的交互。

    例如: 大多數在本語言演化總結中不值得提及的特性。結構化綁定 ([§8.2](08.md#82-結構化綁定)) 和運算符 `<=>` ([§8.8.4](08.md#884-預設比較)) 都需要多次會議去完善。

- **後來者居上**: 有時經過多年的工作之後, 提案已接近投票表決, 一些一向未曾關注提案的委員此時進入討論並提供了替代提案。這樣的提案可能與原始提案有戲劇性的差異, 或者只是一系列小的請求。這往往導致延遲、混亂、甚至有時是爭執。這種時候, 已經議定的問題又重被激活, 而未經嘗試 (通常也未實現) 的新想法和多年工作的成果獲得了接近相等的權重。對老提案而言, 瑕疵已經被發現過了, 相應的技術折中也已經完成。人們很容易想象新事物的好處而忘記意外後果定律: **意外後果總是會出現的**。新的和相對未經審查的總是看起來比老的更好。這使得較早提案的擁護者變得具有防禦性, 從而分散了進一步完善“老提案”的精力。在這裡“老”可能只是幾年, 或者就像概念 ([§6](06.md#6-概念)) 那樣十幾年。有時, 接受未經嘗試的後期變更 (所謂改進) 是為了安撫反對派; 這經常導致意外的後果。後期加入討論的人們, 通常不會認為有“衝刺的必要”, 而是自然地希望他們自己的想法得到認真考慮 (而通常並沒有認真考慮老提案的細節和理由) 。這就可能會與已經在老提案上投入多年工作的人們產生摩擦。

    例子: 結構化綁定 (語法更改, 對位域的新增支援, 笨拙的 `get()` ([§8.2](08.md#82-結構化綁定)) ) 、概念 ([§6](06.md#6-概念)) 。數字分隔符 ([§5.1](05.md#51-數字分隔符)) 、點運算符 ([§8.8.2](08.md#882-點運算符)) 、模組 ([§9.3.1](09.md#931-模組)) 、協程 ([§9.3.2](09.md#932-協程)) 、契約 ([§9.6.1](09.md#961-契約)) 。

- **熱情總青睞新事物**: 喚起對新事物的熱情比反對它們容易。每個提案都是為某人解決某事, 支援者願意花大量時間展現其價值。而要反對它們, 有人就不得不說像這樣的話: 
    - “不, 這個問題不是那麼重要。”
    - “不, 這種解決方案有缺陷。”
    - “不, 你還沒有充分記錄解決方案。”
    - “不, 你還沒有仔細檢查替代方案。”

    不管措辭怎麼客氣, 這都讓反對者看起來更像“壞人”, 是他們阻礙了進步並否認支援者需求的合理性。更糟糕的是, 擁護者總是比反對者花費更多的時間來準備論文和演講。大多數人喜歡對自己相信的事物進行建設性的工作, 而不是小心地拆除他人的工作。因此, 支援者通常都很熱情並且準備充分, 而反對者總是顯得意見含糊而不懂細節。然而, 每項新特性都有其成本: 如設計、規範、實現、修訂、部署和教學 ([§9.5](09.md#95-次要特性)) 。我害怕在演化工作組度過周四下午。那時, EWG 成員經過幾天的大提案工作而感到疲倦, 許多老成員 (例如我) 已經被拖入其他小組, 參會者又急於看到有成果。這種時候, 小提案就會只經受相對較少的審查而滑入標準。

    例如: 條件中的顯式測試 ([§8.7](08.md#87-條件的顯式測試)) 、`inline` 變數 ([§8](08.md#8-c17大海迷航)) 、結構化綁定的後期更改 ([§8.2](08.md#82-結構化綁定)) 。

- **過度自信**: 相對於整個語言及標準庫的複雜度, 尤其是不同應用領域的 C++ 使用者所面臨的問題的複雜度, 個人在日常工作中能獲得的經驗總是不足的。並非所有委員會成員都能意識到這一侷限, 或是能通過質疑自身經驗的推廣價值加以彌補。這就導致某些一般性有限的提案被過度推廣。更糟糕的是, 一些委員強烈反對某些提案, 是因為他們不認為有必要解決該提案所針對的問題。語言設計需要一定的智力上的謙遜 [Stroustrup 2019b]。先想出來的解決方案很少是最好的, 而未經進一步認真思考就提出輕率的反對意見和建議很少會帶來改進。

    例子: 出於對犯錯者的保護, 就不舉例了。

- **實現時機不當**: 在標準流程中, 實現提案晚了有風險: 特性出現嚴重缺陷、有潛在無法實現的部分、以及缺乏使用反饋; 實現早了也有風險: 特性以不完整的、次優的且難以使用的形式凍結。委員會中的許多人不會投票贊成尚未實現或以他們不信任的方式實現的提案。另一方面, 許多實現者不願意為委員會未批准的提案投入實現資源。這是一個困難而現實的兩難困境。委員會經常聽到“它已經實現了嗎? ”的問題。通常, “它是經過設計的嗎? ” 和“要如何使用? ” 是更重要的問題。人們很容易在細節中迷失。我提出的走出這一困境的方法是, 就建議的方向、提案的總體範圍達成一致, 然後從一個相對較小子集的詳細設計和實現出發, 以關鍵用例為指導前進。這樣, 我們可以相對較早地獲得使用者體驗, 並瞭解該特性如何與其他特性交互。這需要對這種語言應該是什麼有一個長遠的看法 [Stroustrup 1993, 1994, 2007] ([§1](01.md#1-前言)) ,  ([§11.2](11.md#112-技術上的成功)) , 否則語言就會淪為機會主義的零敲碎打。如果這個方法起作用, 語言將從反饋和有機增長中受益。

    例子: 模組 ([§9.3.1](09.md#931-模組)) 、C++ 0x 概念 ([§6](06.md#6-概念)) 和 `<=>` ([§8.8.4](08.md#884-預設比較)) 。

- **特性交互**: 最難處理的問題之一是特性的組合使用。一定程度上這是規範和實現的技術問題。因此, 這會占用大量委員會時間。從設計的角度來看, 更難的問題是要預計新特性在整個語言的語境中如何使用, 這些語境包括其他正在考慮中的語言和庫的新特性。每個特性都應設計成便于同其他特性結合使用。我擔心這一點沒有得到重視。很少有提案書提供詳細的討論, 而委員會裡關於特性交互的討論往往簡短或混亂。其結果之一是, 個別特性趨于膨脹而只好把它孤立於語言的其餘部分才能用起來。

    例子: `tuple` ([§4.3.4](04.md#434-tuple)) 和 `<=>` ([§9.3.4](09.md#934-)) 。為 lambda 表達式 ([§4.3.1](04.md#431-lambda-表達式)) 中的動作指定專用語法的 (失敗) 提案。

- **篇幅和分心**: 千頭萬緒往往同時發生, 沒有人能全跟得上。那些嘗試全部關注的人, 就容易失去對真正重要課題的關注, 而把注意力分散在一些事實證明並不那麼重要的課題上。如今每年有超過 500 篇委員會論文, 有些長達數十甚至數百頁。與 2010 年代初相比, 文獻總篇幅翻了一番。我注意到, 2018 年秋天的會前郵件 (新論文彙總) 的字數是莎士比亞全集的三倍。

    電子郵件的氾濫最讓人分心, 因為許多委員喜歡通過一波一波地爆發短郵件來進行技術討論。在這樣的討論中掉隊意味着失去對問題的跟蹤, 其結果可能是, 共識只是從幾個一直能跟得上討論的人中間浮現。

    這種討論不利於冷靜而系統地權衡各種選擇。有時候, 它會導致不幸的特性滑入標準。有時候, 它會導致不一致的設計理念體現于語言和標準庫的不同部分, 進而損害了互操作性。

    例子: `any`、`optional` 和 `variant` 的不同介面。概念 ([§6](06.md#6-概念)) 。

- **精確規範**: 標準是規範, 而不是實現。但是, 標準是用英語編寫的, 因此我們做不到數學般的精度。委員會的許多成員擅長數學, 但不擅長數學的人更多, 因此在規範中沒辦法使用數學記法。試圖使英文文本精確而詳盡, 則會讓文本變得生硬又難以理解。我常常很難理解標準中對我自己提案的描述。

    大多數委員是程式員, 而不是設計師, 因此規範有時看起來會像程式——用沒有類型系統或編譯器的低級語言寫成的程式。有詳盡的如果、那麼、否則的說明, 卻很少寫出不變數。更糟糕的是, 很多詞彙是繼承自 C, 而且是基于程式原始碼文本中的標記, 因此, 更高級別的概念僅被間接提出。

    奇怪的是, 標準庫規範在結構上明顯比語言規範更為正式。

- **經院主義**: 當然有必要大力強調標準文本的正確性和準確性。但是, 人們有時會忘記標準本身可能就是錯誤的, 而僅根據標準文本的論證來討論正確性。這樣一來, 根據標準文本所應反映的模型和使用上的論證, 反倒可能被忽略。

- **方向**: 哪些問題是真實的? 重要嗎? 對於誰? 哪些緊急? 十年後, 哪些解決方案仍然有意義? 有些事情也許算個問題, 但這並不意味着它必須在語言裡有直接的解決方案。尤其是, 委員會很難記住這一點: 一種語言不可能對所有人來說都是萬能的。更難以接受的是, 它居然不能解決每個委員最緊急的問題 [Stroustrup 2018d]。

    例子: C++17 ([§8](08.md#8-c17大海迷航)) 和 C++ 20 ([§9](09.md#9-c20方向之爭)) 。

- **專一關注**: 一些委員僅關注一個或兩個課題, 例如語言技術、易用性、“可教學性”、效率、使用單一編程風格、在單個行業中使用、在單個公司中使用、單個語言特性等。對於專一關注的委員而言, 這可能是一種非常有效的技巧, 但這樣做會讓廣泛的、平衡的進展變得困難。過分相信理論或個人經驗則是這個問題的另一類例子。一個好的建議在許多領域都會推動進步, 但通常不能在所有這些方面都達到完美。

- **原則的不適當應用**: 將一般原則應用於具體事例通常很困難。有時, 我們會不與其他原則進行必要折中, 就去嚴格應用某項原則。折中的必要性是《設計和演化》一書 [Stroustrup 1994] 將設計原則稱為“經驗法則”的原因之一。有時, 似乎沒有經驗基礎就憑空冒出來一個原則。有時, 一個提案嚴格遵循了某一個原則, 而另一個提案則忽略它。有原則的設計很困難; 它需要品味、經驗以及原則。實用的語言設計不只是從第一原理出發進行演繹的練習。通常, 多種原則之間必須進行權衡。

- **傾向專家的偏見**: 想象別人的問題總是困難的。委員會成員几乎都是某方面的專家。在日常工作中, 他們通常是處理最細微、最複雜問題的人。這樣的問題在“外面”的數十億行常規 C++ 程式碼中一般不常見, 而且也不是大多數 C++ 程式員所苦惱的問題。但是, 對委員會來說, 專家級的問題通常就是緊急問題, 也是最容易通過流程的問題。

    例子: 支援 `enable_if` 和類型特徵 ([§4.5.1](04.md#451-實現技巧)) 在標準庫中的使用簡直水到渠成, 但接受概念 ([§6](06.md#6-概念)) 卻大費周章。

- **聰明的問題**: 委員會成員一般是聰明人, 他們中許多人無法抵禦機靈的解決方案。此外, 他們也很難斷定, 並非每個問題都值得解決, 而擁有解決方案也並不意味着我們必須將其納入標準。這會帶來過于精巧的特性, 帶來大多數程式員用不着的特性。公平起見, 也需要指出, 許多程式員也很聰明, 有時也會以使用過分機靈的語言和標準庫特性為樂。

    例子: 在有些提案中, 即使簡單用法也需要用上嚴肅的模板元編程。

- **不願妥協**: 大多數委員會成員都有強烈的意見, 但要在一個大型團體中達成共識需要妥協。分辨哪些妥協無關緊要, 而哪些妥協事關基本原則, 有時會很困難。後一類妥協可能對語言造成破壞, 應該避免。不幸的是, 當委員們堅信自己所擔憂的才至關重要時, 他們比起心態開放的委員就有了有關鍵的戰術優勢。有些人能做到從整體上關注語言而不糾結于個別話題, 但他們往往得向不能如此的人們屈服。而反過來, 那些從不認真質疑自己的原則或需求的人, 倒往往可以向別人視為必要的技術妥協發動猛攻。取得進展需要關注整個社區, 有自知之明, 並懂得適當的謙遜 [Stroustrup 2019b]。

- **缺乏優先順序**: 從技術的角度來看, 所有問題都是平等的: 不精確的規範就是不精確規範, 這一點與它未能正確規定的內容是什麼不相干。任何可能從類型系統的漏洞中混進程式碼的錯誤原則上都可能造成死亡和毀滅。但是, 現實世界中不同錯誤的影響可能大不相同。實際上, 大多數晦澀的細節基本上沒有破環性。有些人在研究設計細節時很難記住這一點。

    例子: 在數字分隔符 ([§5.1](05.md#51-數字分隔符)) 上花費的時間比在範圍 `for` ([§4.2.2](04.md#422-範圍-for)) 上花費的時間更多。

- **完美主義**: 一個標準預期會被幾百萬人用到, 並且可以穩定數十年。人們自然希望它是完美的。這會導致特性膨脹 (特性過多) , 尤其是導致單個特性的膨脹。程式員善於想象出問題, 特性在委員會走流程的時候, 委員們會堅持要它解決掉所有想象中的問題。這會導致嚴重的使命偏離, 並導致只有專家才會喜愛的特性。這也可能導致特性一直無法加入標準。

    例子: `.` 運算符 ([§8.8.2](08.md#882-點運算符)) 、網路庫 ([§8.8.1](08.md#881-網路庫)) 和異常規約 ([§4.5.3](04.md#453-noexcept-規約)) 。

- **少數人的阻撓**: 共識流程可以防止某些類型的錯誤, 尤其是防止多數人的暴政。但是, 它很容易受到個人和小團體的阻撓。這可以是好事 (避免錯誤) , 但是當它在提案流程的各個階段一再發生, 或正好在最後一刻發生時, 就會具有破壞性了。

    例子: `constexpr` ([§4.2.7](04.md#427-constexpr-函數)) 、`.` 運算符 ([§8.8.2](08.md#882-點運算符)) 、模組 ([§9.3.1](09.md#931-模組)) 和協程 ([§9.3.2](09.md#932-協程)) 。

- **內聚的團體**: 許多工作組和研究組都擁有穩定的核心人員群體, 這些年來他們形成了內聚的技術觀、共享的詞彙表和特定的運作方式。這會使“外部人員”難以交流和貢獻。這也可能使設計跨越 WG 邊界的特性 (例如同時具有庫和語言部分的特性) 變得困難。每個小組都往往會設計出適合其自身組織結構領域的內容, 再次印證了老格言, 即系統的結構總是長得像創造它的組織的結構。

    例子: 範圍 `for` ([§4.2.2](04.md#422-範圍-for)) 和可能需要更改語言的並發機制 ([§4.1.3](04.md#413-期值future)) 。`any`、`optional` 和 `variant` ([§8.3](08.md#83-variantoptional-和-any)) 的介面差異。

從積極的一面來看, 基于個人敵意或針鋒相對的行為非常罕見。從這個意義上講, 委員會是非常專業的。

幸運的是, 並非每個提案都受所有這些現象的影響, 並且大多數其他大型項目也會遇到這類問題。但是, 以其 ISO 標準所代表的 C++ 語言, 整體上反映出了這些現象。它們不是新問題, 但是自 C++11 起出現得越來越多。我懷疑它們是由以下因素共同造成的

- 委員會人數增加
- 新人的湧入
- 成員的專業化 (分散化) 
- 成員對 C++ 歷史的瞭解有所減少

儘管存在這些嚴重的問題, 但標準制定流程仍屢屢成功, 原因之一是很多人不斷努力將負面影響降到最低。方向組 (Direction Group) 的建立就是這方面的努力的一部分 ([§3.2](#32-組織)) [Dawes et al. 2018; Stroustrup 2018d]。另見 ([§11.4](11.md#114-教訓)) 。工作組主席、筆記記錄員、會議組織者和編輯組的不懈努力是無形的, 但卻至關重要。例如, Jens Maurer 數十年來一直在 CWG 中做筆記, 幫助提案者編寫標準文本, 安排網路訪問, 為無法出席的成員安排電話接入, 安排會議室, 告知成員當地旅行的可能性, 等等。

有其他方案嗎? 在理想的世界裡, 我會建議限定由一小部分 (大約 5 人) 的全職受信任專家委員做決定, 而由大團隊完成 (例如超過 350 人的委員會) 完成討論、提案、以及大部分流程。但我不認為 C++ 會發展成這樣, 因為: 

- 沒有人喜歡放棄權力 (在這種情況下是投票權) 。
- 要為固定的全職專家團隊保持穩定的資金投入需要非同小可的技能 (而這種技能在 C++ 社區還沒有出現) 。
- 成功的時刻不會發生激進的變化; 只有 C++ 使用量的顯著下降才能促進委員會進行劇烈的組織創新 (那時多半已經為時已晚) 。

我不認為公司控制是可行的替代方案, 因為: 

- 公司期望投資回報。
- 公司的支援往往幾年後就會消失。
- 公司往往選擇差異化的優勢, 而不是惠及所有人的進步。

我也不認為完全開放的審議流程 (成千上萬的投票者) 是可行的: 

- 超過千人的投票就會失去品味。
- 大群體的成員和意見沒法在幾十年裡保持穩定。

對許多大型開源項目起作用的分級審批程式可能至少提供了部分方案, 但是在 C 和 C++ 的標準化開始時, 這方面的經驗很少。當這樣一個系統運行良好時, 你在審批層級中的地位越高, 審批者的知識基礎就越廣闊, 他們關注的領域也就越廣泛。在組織結構頂部, 我們會找到一人或多人, 他們對所有知識都有所瞭解、對所有使用者都有所關心。與此鮮明對比的是, 隨着提案接近最終批准, ISO 流程會稀釋專業知識和關注領域: 全體會議上, 許多委員對他們不感興趣、領域經驗有限且沒有密切關注的提案進行投票。人們努力想負起責任, 但是這真的很難。還要從大局角度來看待每個提案, 把它們當作其中的一部分, 那就几乎不可能了。

這樣看來, WG21 的工作還不算糟糕。我確實擔心這樣的工作模式能否使 C++ 長久保持連貫、並且與時俱進。從另一個角度來看, 出席 C++ 標準會議的有 200 多人, 比其他標準的團體要大一個數量級, 而 ISO 的流程本來就是為那種較小的團體設計的。另外, 委員的多樣性遠遠超過了過去的老三樣: 頭髮斑白的專家、公司代表、以及國家機構代表。混亂有可能爆發。

我從溫斯頓·丘吉爾的格言中得到些許安慰, “民主是最糟糕的政府形式, 除了所有那些人類一再嘗試過的其他形式”。

特別要指出, 我不認為經常被建議的“仁慈的終身獨裁者”模式可以規模化, 而且, 不管怎麼說, 該模型從來就沒對 C++ 適用過。

在我心目中, 啟動語言設計項目的理想模式是單個人或一小群密切配合的朋友。但我看不到這種方式可以規模化。一門成熟的語言需要數十甚至數百個人來解決他們必須面對的各種問題。即使只是與相關的標準、行業組織進行協調, 也會讓一個小規模、緊密配合的團體徹底應接不暇。

## 3.4 提案檢查清單

C++98 有個“如何編寫提案”的指南 [Stroustrup et al. 1992], 但奇怪的是, 演化組並沒有為提給 C++14、C++17 或 C++20 的提案準備一份檢查清單。有一份針對標準庫提案的檢查清單 [Meredith 2012]。對於 C++20, 國家標準機構負責人的一份說明 [van Winkel et al. 2017] 和 Direction Group 的一份檔案 [Hinnant et al. 2019] 給出了一些指導。以下是一個簡短而不完整的問題清單, 這些問題几乎總會被提給一項提案: 

- 要解決的問題是什麼? 將為什麼樣的使用者提供服務? 新手? 專家? 
- 解決方案是什麼? 闡明它所基于的原則。給出簡單的使用案例和專家級的使用案例。
- 有哪些替代解決方案? 庫解決方案是否足夠? 為什麼現有功能不夠好? 
- 為什麼解決方案需要在標準中? 
- 採用該技術存在哪些障礙? 從現有的技術過渡可能需要多久? 
- 已經實現了嗎? 在實現過程中遇到了或預期會遇到哪些問題? 有使用者體驗嗎? 
- 會不會有很大的編譯期開銷? 
- 該特性是否能融入到現有工具和編譯器的框架中? 
- 與變通方案相比, 會有運行期開銷嗎? 在時間上? 在空間上? 
- 會有兼容性問題嗎? 會破壞現有的程式碼嗎? ABI 會被破壞嗎? 
- 新功能將如何與現有功能和其他新功能交互? 
- 解決方案是否容易教授? 教給誰? 誰來教? 
- 標準庫會受到怎樣的影響? 
- 該提案是否會導致對未來標準進一步擴展的要求? 
- 該特性在標準裡如何措辭表達? 
- 使用者在使用新功能時可能會犯哪些錯誤? 
- 就整個 C++ 社區的利益而言, 該提案是否屬於前 20 名? 前 10? 
- 該提案是否屬於特定子社區的前三名? 哪個子社區? 
- 該提案是解決某一類問題的通用機制還是某個特定問題的特定解決方法? 如果是針對一類問題, 是哪一類問題? 
- 該提案在語義、語法和命名方面是否與語言的其餘部分一致? 

理想的情況是, 一項提案能夠回答所有這些問題, 甚至更多, 但這種情況很少發生。特別是, 在最初的提案中, 理由往往非常薄弱, 因為提案者認為所處理的問題的重要性和他們建議的解決方案非常明顯。然而, 後續的論文、修改、電子郵件討論和演化組的面對面討論通常都會涉及這些問題, 但很少對各個提案進行系統的或一致的檢查。成員們傾向于關注技術細節 (例如, 語法、歧義、優化機會和命名) , 而不是重新探討根本問題。有時, 我所認為的糟糕的提案會混進去。原因通常是提案者的極大熱情加上反對者的分心、禮貌和疲憊 [Stroustrup 2019b]。
